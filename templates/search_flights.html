<!-- templates/search_flights.html -->
{% extends "base.html" %}

{% block title %}Search Flights - Airline Reservation System{% endblock %}

{% block content %}
    <h2>Search Flights</h2>
    <form method="POST">
        <!-- Origin Input -->
        <div class="form-group">
            <label for="origin">Origin (IATA Code):</label>
            <input type="text" id="origin" name="origin" placeholder="e.g., DEL" class="form-control" required>
        </div>

        <!-- Destination Input -->
        <div class="form-group">
            <label for="destination">Destination (IATA Code):</label>
            <input type="text" id="destination" name="destination" placeholder="e.g., BOM" class="form-control" required>
        </div>

        <!-- Departure Date Input -->
        <div class="form-group">
            <label for="departure_date">Departure Date:</label>
            <input type="date" id="departure_date" name="departure_date" class="form-control" required>
        </div>

        <!-- Search Button -->
        <button type="submit" class="btn btn-primary">Search Flights</button>
    </form>

    <!-- Recommendations Section -->
    {% if recommendations %}
        <h3 class="mt-5">Recommended Flights for You</h3>
        <table class="table table-bordered">
            <thead>
                <tr>
                    <th>Airline</th>
                    <th>Flight Number</th>
                    <th>Origin</th>
                    <th>Destination</th>
                    <th>Departure Time</th>
                    <th>Arrival Time</th>
                    <th>Price</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody>
                {% for flight in recommendations %}
                    <tr>
                        <td>{{ flight["Airline"] }}</td>
                        <td>{{ flight["Flight Number"] }}</td>
                        <td>{{ flight["Origin"] }}</td>
                        <td>{{ flight["Destination"] }}</td>
                        <td>{{ flight["Departure Time"] }}</td>
                        <td>{{ flight["Arrival Time"] }}</td>
                        <td>{{ flight["Price"] }}</td>
                        <td>
                            <form method="POST" action="{{ url_for('book_flight') }}">
                                <input type="hidden" name="flight_id" value="{{ flight["Flight ID"] }}">
                                <input type="hidden" name="price" value="{{ flight["Price"] }}">
                                <button type="submit" class="btn btn-success">Book Flight</button>
                            </form>
                        </td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    {% elif not flights and request.method == 'GET' %}
        <h3 class="mt-5">No Recommendations Available</h3>
        <p>Book some flights or update your preferences to receive personalized recommendations.</p>
    {% endif %}

    <!-- Display Searched Flights if Available -->
    {% if flights %}
        <h3 class="mt-5">Search Results</h3>
        <table class="table table-bordered">
            <thead>
                <tr>
                    <th>Airline</th>
                    <th>Flight Number</th>
                    <th>Origin</th>
                    <th>Destination</th>
                    <th>Departure Time</th>
                    <th>Arrival Time</th>
                    <th>Price</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody>
                {% for flight in flights %}
                    <tr>
                        <td>{{ flight.airline }}</td>
                        <td>{{ flight.flight_number }}</td>
                        <td>{{ flight.origin }}</td>
                        <td>{{ flight.destination }}</td>
                        <td>{{ flight.departure_time }}</td>
                        <td>{{ flight.arrival_time }}</td>
                        <td>${{ flight.price }}</td>
                        <td>
                            <form method="POST" action="{{ url_for('book_flight') }}">
                                <input type="hidden" name="flight_id" value="{{ flight.flight_id }}">
                                <input type="hidden" name="price" value="{{ flight.price }}">
                                <button type="submit" class="btn btn-success">Book Flight</button>
                            </form>
                        </td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    {% endif %}
{% endblock %}
